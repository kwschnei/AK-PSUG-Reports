<!DOCTYPE html>
<html>
<head>

<style>
@-moz-document url-prefix() {#inputDays {width: 25px; }}
</style>

<title>Gradebook Update Report</title>
<meta name="description" content="Displays a listing of sections by teacher that have not had their gradebooks recently updated">
~[wc:commonscripts]
<link href="/images/css/screen.css" rel="stylesheet" media="screen">
<link href="/images/css/print.css" rel="stylesheet" media="print">
<script>
//Find results
function find()
{
var org = document.getElementById('inputDays').value;
//Test if input is valid int
var intRegex = /^\d+$/;
if (intRegex.test(org))
	{
		//Reload page w/new org variable
		window.location.href = 'gradebookupdatereport.html?days=' + org;
	}
else 
	{alert('Please enter a valid whole number and try again');}
}
</script>
</head>
<body>
~[wc:admin_header_css]<!-- breadcrumb start --><!-- breadcrumb start --><a href="/admin/home.html" target="_top">~[text:psx.html.admin_reports.reportsetup.start_page]</a> &gt; <a href="/admin/reports/home.html">~[text:psx.html.admin_reports.reportsetup.reports]</a> &gt; <a href="/admin/reports/AKPSUGreports.html">AKPSUG Reports</a> &gt;Gradebook Not Updated<!-- breadcrumb end -->~[wc:admin_navigation_css]

<h1>Gradebook Update Report</h1><!-- start of content and bounding box -->
<p>Look for teachers by class that have not updated their gradebook in <input id="inputDays" type="number" min="1" max="999" value="~[gpv:days]"> or more days. <button onclick="find()">Find</button></p>
<div class="box-round">
<!-- Generate results for district office level -->
~[if#VarCheck.~(curschoolid)=0]
<table border="0" cellspacing="0" cellpadding="4" align="center" background="/images/transparent.gif">
<thead>
	<tr class="headerRow">
		<th class="bold">School</th>
		<th class="bold">Teacher</th>
		<th class="bold">Course Number</th>
		<th class="bold">Course</th>
		<th class="bold">Section</th>
		<th class="bold">Enrolled</th>
		<th class="bold">Last Updated</th>
	</tr>
</thead>
<tbody>
	~[tlist_sql;
	select distinct		s.name
						,t.lastfirst
						,c.course_number
						,c.course_name
						,cc.section_number 
						,sec.no_of_students
						,min(replace(to_char(cc.lastgradeupdate, 'MM/DD/YYYY'),'01/01/1900','Never')) as lastgradeupdate
	from 				cc, teachers t, courses c, terms tr, schools s, sections sec
	where 				t.id = cc.teacherid
		and 			c.course_number = cc.course_number
		and				t.schoolid = s.school_number
		and 			tr.id = cc.termid 
		and				sec.id = cc.sectionid
		and 			tr.schoolid = cc.schoolid
		and cc.termid in (	select trx.id 
							from terms trx 
							where trx.schoolid = cc.schoolid  
							and trx.firstday < = sysdate and trx.lastday >= sysdate)
		and 			cc.lastgradeupdate < sysdate-~[gpv:days]
		and 			lower(c.course_name) not like '%advisory%'
		and 			lower(c.course_name) not like '%am%'
		and 			lower(c.course_name) not like '%pm%'
		and 			lower(c.course_name) not like '%study hall%'
                and                     lower(c.course_name) not like '%Behavior%'
                AND                     lower(c.course_number) NOT LIKE 'caseload'
                AND sec.excludefromstoredgrades != 1
  AND (c.excludefromstoredgrades = 0 AND sec.excludefromstoredgrades IN (0,2))
		group by 		s.name
						,t.lastfirst
						,c.course_number
						,c.course_name
						,cc.section_number 
						,sec.no_of_students
		order by 		
			s.name, t.lastfirst, c.course_name, cc.section_number
;alternatecolor]
<span style="display: none;">~(school) ~(name) ~(course_number) ~(course_name) ~(section_number) ~(enroll) ~(lastgradeupdate)</span>
<tr bgcolor="#edf3fe">
<td align="left">~(school)</td>
<td align="left">~(name)</td>
<td align="left">~(course_number)</td>
<td align="left">~(course_name)</td>
<td align="left">~(section_number)</td>
<td align="left">~(enroll)</td>
<td align="center">~(lastgradeupdate)</td>
</tr>
[/tlist_sql]</tbody>
</table>
<!-- Generate results for a specific school -->
[else#VarCheck]
<table border="0" cellspacing="0" cellpadding="4" align="center" background="/images/transparent.gif">
<thead>
	<tr class="headerRow">
		<th class="bold">Teacher</th>
		<th class="bold">Course Number</th>
		<th class="bold">Course</th>
		<th class="bold">Section</th>
		<th class="bold">Enrolled</th>
		<th class="bold">Last Updated</th>
	</tr>
</thead>
<tbody>
	~[tlist_sql;
	select distinct		
						t.lastfirst
						,c.course_name
						,c.course_number
						,cc.section_number 
						,sec.no_of_students
						,min(replace(to_char(cc.lastgradeupdate, 'MM/DD/YYYY'),'01/01/1900','Never')) as lastgradeupdate
	from 				cc, teachers t, courses c, terms tr, schools s, sections sec
	where 				t.id = cc.teacherid
		and 			c.course_number = cc.course_number
		and				t.schoolid = s.school_number
		and				sec.id = cc.sectionid
		and 			tr.id = cc.termid 
		and 			tr.schoolid = cc.schoolid
		and cc.termid in (	select trx.id 
							from terms trx 
							where trx.schoolid = cc.schoolid  
							and trx.firstday < = sysdate and trx.lastday >= sysdate)
		and 			cc.lastgradeupdate < sysdate-~[gpv:days]
		and 			lower(c.course_name) not like '%advisory%'
		and 			lower(c.course_name) not like '%am%'
		and 			lower(c.course_name) not like '%pm%'
		and 			lower(c.course_name) not like '%study hall%'
                and 			lower(c.course_name) not like '%behavior%'
                AND                     lower(c.course_number) NOT LIKE 'caseload'
                AND sec.excludefromstoredgrades != 1
  AND (c.excludefromstoredgrades = 0 AND sec.excludefromstoredgrades IN (0,2))
		and cc.schoolid = ~(curschoolid)
		group by 		t.lastfirst
						,c.course_number
						,c.course_name
						,cc.section_number 
						,sec.no_of_students
		order by 		
			t.lastfirst, c.course_name, cc.section_number
;alternatecolor]
<span style="display: none;">~(name) ~(course_number) ~(course_name) ~(section_number) ~(enroll) ~(lastgradeupdate)</span>
<tr bgcolor="#edf3fe">
<td align="left">~(name)</td>
<td align="left">~(course_number)</td>
<td align="left">~(course_name)</td>
<td align="left">~(section_number)</td>
<td align="left">Enrolled</td>
<td align="center">~(lastgradeupdate)</td>
</tr>
[/tlist_sql]
</tbody>
</table>
[/if#VarCheck]
<br>
<div class="button-row"></div>
</div>
<br>
<!-- end of content of bounding box -->
~[wc:admin_footer_css]
</body>
</html>